<!DOCTYPE html>
<html xmlns:v-on="http://www.w3.org/1999/xhtml">

<head>
  <meta charset="UTF-8">
  <!-- import Vue before Element -->
<!--  <script src="https://unpkg.com/vue/dist/vue.js"></script>-->
      <script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>

  <!-- import CSS -->
  <!--    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">-->
  <!-- import JavaScript -->
  <!--    <script src="https://unpkg.com/element-ui/lib/index.js"></script>-->

  <!-- import Axios -->
  <!--    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>-->
  <script src="https://cdn.bootcss.com/axios/0.19.2/axios.min.js"></script>
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
  <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
  <title>中华人民共和国统计用行政区划代码</title>
</head>

<body>
<div class="container-fluid" id='xzqh' v-cloak>
  <div class="row text-center">
    <a :href="'http://www.stats.gov.cn/tjsj/tjbz/tjyqhdmhcxhfdm/'+year" title="点击跳转国际统计局行政区划代码">
      <img src="images/banner.jpg">
    </a>
    <h3>中华人民共和国统计用区划代码和城乡划分代码</h3>
  </div>
  <div class="row"> 年份
    <label v-for="item in years" @click="isPar=1">
      <input type="radio" name="year" :value="item" v-model="year"/>
      {{item}} &nbsp; &nbsp; &nbsp; &nbsp;
    </label>
  </div>

  <div class="row">
    <div class="col-sm-2">
      <table class="table table-striped table-hover">
        <tr>
          <th>行政区划代码</th>
          <th>名称</th>
        </tr>
        <tr v-for='item in provinces' @click='itemClickFn(item)' :style="province === item[0]?css:''" :key="year+item[0]">
          <td>{{item[0]/1000000}}</td>
          <td>{{item[1]}}</td>
        </tr>
      </table>
    </div>
    <div class="col-sm-2" v-show="cities.length">
      <table class="table table-striped table-hover">
        <tr>
          <th>行政区划代码</th>
          <th>名称</th>
        </tr>
        <tr v-for='item in cities' @click='itemClickFn(item)' :style="city===item[0]?css:''" :key="year+item[0]">
          <td>{{item[0]/1000000}}</td>
          <td>{{item[1]}}</td>
        </tr>
      </table>
    </div>
    <div class="col-sm-2" v-show="counties.length">
      <table class="table table-striped table-hover">
        <tr>
          <th>行政区划代码</th>
          <th>名称</th>
        </tr>
        <tr v-for='item in counties' @click='itemClickFn(item)' :style="county===item[0]?css:''" :key="year+item[0]">
          <td>{{item[0]/1000000}}</td>
          <td>{{item[1]}}</td>
        </tr>
      </table>
    </div>
    <div class="col-sm-3" v-show="towns.length">
      <table class="table table-striped table-hover">
        <tr>
          <th>行政区划代码</th>
          <th>名称</th>
        </tr>
        <tr v-for='item in towns' v-on:click='itemClickFn(item)' :style="town===item[0]?css:''" :key="year+item[0]">
          <td>{{item[0]/1000}}</td>
          <td>{{item[1]}}</td>
        </tr>
      </table>
    </div>
    <div class="col-sm-3" v-show="villages.length">
      <table class="table table-striped table-hover">
        <tr>
          <th>城乡分类代码</th>
          <th>行政区划代码</th>
          <th>名称</th>
        </tr>
        <tr v-for='item in villages' @click='itemClickFn(item)' :style="village===item[0]?css:''" :key="year+item[0]">
          <td>{{item[2]}}</td>
          <td>{{item[0]}}</td>
          <td>{{item[1]}}</td>
        </tr>
      </table>
    </div>

  </div>


</div>

</div>

<style>
  [v-cloak] {
    display: none;
  }

</style>

</body>


<script>
    // const field = ['', 'province', 'city', 'county', 'town', 'village'];
    // const fields = ['', 'provinces', 'cities', 'counties', 'towns', 'villages'];
    const vm = new Vue({
        el: '#xzqh',
        data: {
            china: '000000000000', isPar: 1,
            years: ['2020', '2019', '2018'], year: '',
            provinces: [], province: '',
            cities: [], city: '',
            counties: [], county: '',
            towns: [], town: '',
            villages: [], village: '',
            field: ['country', 'province', 'city', 'county', 'town', 'village'],
            fields: ['countries', 'provinces', 'cities', 'counties', 'towns', 'villages'],
            css: {background: '#409EFF', fontSize: '17px', color: 'white'}

        },
        methods: {
            itemClickFn(item) {
                this.isPar = item[3];
                let level = item[2] > 4 ? 5 : item[2];
                vm[this.field[level]] = item[0];
            },
            getJson: function (code, type) {
                if (this.isPar < 1) {
                    this.clearArr(type);
                    return "没有下级行政机构";
                }
                if (!code) {
                    return "目标行政代码为空"
                }
                axios.get('json/' + this.year + '/' + code + '.json')
                    .then(function (response) {
                        let dataType = response.data[0][2] > 4 ? 5 : response.data[0][2];
                        vm[vm['fields'][dataType]] = response.data;
                        vm[vm['field'][dataType]] = response.data[0][0];
                        vm['isPar'] = response.data[0][3];
                        if (dataType > type) {
                            vm.clearArr(type, dataType);
                        }
                    })
                    .catch(function (error) {
                            vm.clearArr(type);
                            console.log(error);
                        }
                    );
            },
            clearArr(start, end) {
                start = start || 0;
                end = end || vm.fields.length;
                vm.field.forEach((val, i) => {
                    if (i >= start && i < end) {
                        vm[vm.fields[i]] = [];
                        vm[vm.field[i]] = '';
                    }
                });
            }
        },
        watch: {
            year: function (val, oldVal) {
                this.getJson(this.china, 1);
            },
            province(val) {
                this.getJson(val, 2);
            },
            city(val) {
                this.getJson(val, 3);
            },
            county(val) {
                this.getJson(val, 4);
            },
            town(val) {
                this.getJson(val, 5);
            }
        },
        created() {
            this.year = this.years[0];
        }
    });
</script>

<style>

</style>

</html>
